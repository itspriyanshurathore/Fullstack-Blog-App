<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Post</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      #dropZone {
        cursor: pointer;
        border-style: dashed;
        transition: 0.3s;
      }
      #dropZone.hover {
        border-color: #0d6efd !important;
        background-color: #e9f2ff;
        transform: scale(1.02);
        box-shadow: 0 0 20px rgba(13, 110, 253, 0.3);
      }
      #newImagePreview {
        display: none;
        width: 100%;
        max-height: 300px;
        object-fit: cover;
        border-radius: 8px;
      }
    </style>
  </head>

  <body class="bg-light">
    <%- include('partials/header') %>

    <div class="container mt-5">
      <h2 class="fw-bold text-primary mb-4">
        <i class="bi bi-pencil-square"></i> Edit Blog Post
      </h2>

      <div class="card p-4 shadow-sm">
        <form
          action="/post/edit/<%= post._id %>"
          method="POST"
          enctype="multipart/form-data"
          class="d-grid gap-4"
        >
          <!-- CURRENT IMAGE -->
          <div>
            <label class="fw-semibold">Current Image</label><br />
            <img
              id="currentImage"
              src="<%= post.images[0].url %>"
              style="
                width: 100%;
                max-height: 280px;
                object-fit: cover;
                border-radius: 8px;
              "
            />
          </div>

          <!-- DRAG & DROP IMAGE UPLOAD -->
          <div>
            <label class="fw-semibold">Replace Image (optional)</label>

            <div
              id="dropZone"
              class="border border-2 border-primary rounded-3 p-4 text-center bg-white"
            >
              <i class="bi bi-cloud-arrow-up display-5 text-primary"></i>
              <p class="fw-semibold m-0">Drag & Drop a new image</p>
              <p class="text-muted small">or click to browse</p>

              <input
                type="file"
                id="imageInput"
                name="image"
                accept="image/*"
                hidden
              />
            </div>

            <!-- NEW IMAGE PREVIEW -->
            <img id="newImagePreview" alt="New Preview" />
          </div>

          <!-- TITLE -->
          <div>
            <label class="fw-semibold">Blog Title</label>
            <input
              type="text"
              name="title"
              class="form-control"
              value="<%= post.title %>"
              required
            />
          </div>

          <!-- DESCRIPTION -->
          <div>
            <label class="fw-semibold">Short Description</label>
            <input
              type="text"
              name="description"
              class="form-control"
              value="<%= post.description %>"
              required
            />
          </div>

          <!-- CATEGORY -->
          <div>
            <label class="fw-semibold">Category</label>
            <input
              type="text"
              name="category"
              class="form-control"
              value="<%= post.category %>"
              required
            />
          </div>

          <!-- CONTENT -->
          <div>
            <label class="fw-semibold">Full Content</label>
            <textarea name="content" rows="5" class="form-control" required>
<%= post.content %></textarea
            >
          </div>

          <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-save"></i> Update Post
          </button>
        </form>
      </div>
    </div>

    <%- include('partials/footer') %>

    <script>
      const dropZone = document.getElementById("dropZone");
      const imageInput = document.getElementById("imageInput");
      const newImagePreview = document.getElementById("newImagePreview");
      const currentImage = document.getElementById("currentImage");

      dropZone.addEventListener("click", () => imageInput.click());

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("hover");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("hover");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("hover");

        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          imageInput.files = e.dataTransfer.files;
          showPreview(file);
        }
      });

      imageInput.addEventListener("change", () => {
        const file = imageInput.files[0];
        if (file) showPreview(file);
      });

      function showPreview(file) {
        newImagePreview.src = URL.createObjectURL(file);
        newImagePreview.style.display = "block";
        currentImage.style.opacity = "0.4"; // fade old image
      }
    </script>
  </body>
</html>
